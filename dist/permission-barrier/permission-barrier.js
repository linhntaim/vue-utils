"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PermissionBarrier=void 0;var _permissionBarrierAction=require("./permission-barrier-action");function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var PermissionBarrier=/*#__PURE__*/function(){function PermissionBarrier(permit,storeHandler){_classCallCheck(this,PermissionBarrier);this.permit=permit;this.storeHandler=storeHandler;this.routes={};this.actions=[];this.matchingPermissions=[];this.temporaryMatchingPermissions=[];this.temporaryMatchedPermissions=[];this.restoreTemporaryMatchingPermissions();this.restoreTemporaryMatchedPermissions()}_createClass(PermissionBarrier,[{key:"importFromRoutePermissions",value:function importFromRoutePermissions(){var _this=this;var routePermissions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};Object.keys(routePermissions).forEach(function(routeName){var permissions=routePermissions[routeName];_this.routes[routeName]=new _permissionBarrierAction.PermissionBarrierAction(typeof permissions==="string"?permissions.split("|"):permissions)});return this}},{key:"setMatchingPermissions",value:function setMatchingPermissions(){var matchingPermissions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];this.matchingPermissions=matchingPermissions}},{key:"addTemporaryMatchingPermission",value:function addTemporaryMatchingPermission(temporaryPermission){if(!this.temporaryMatchingPermissions.includes(temporaryPermission)){this.temporaryMatchingPermissions.push(temporaryPermission);this.storeTemporaryMatchingPermissions()}return this}},{key:"removeTemporaryMatchingPermission",value:function removeTemporaryMatchingPermission(temporaryMatchingPermission){var i=this.temporaryMatchingPermissions.indexOf(temporaryMatchingPermission);if(i!==-1){this.temporaryMatchingPermissions.splice(i,1);this.storeTemporaryMatchingPermissions()}return this}},{key:"storeTemporaryMatchingPermissions",value:function storeTemporaryMatchingPermissions(){this.storeHandler.setJson("__permission_barrier_temporary_matching_permission",this.temporaryMatchingPermissions);return this}},{key:"restoreTemporaryMatchingPermissions",value:function restoreTemporaryMatchingPermissions(){var _this2=this;(function(temporaryMatchingPermissions){temporaryMatchingPermissions&&(_this2.temporaryMatchingPermissions=temporaryMatchingPermissions)})(this.storeHandler.getJson("__permission_barrier_temporary_matching_permission"));return this}},{key:"addTemporaryMatchedPermission",value:function addTemporaryMatchedPermission(temporaryMatchedPermissions){if(!this.temporaryMatchedPermissions.includes(temporaryMatchedPermissions)){this.temporaryMatchedPermissions.push(temporaryMatchedPermissions);this.storeTemporaryMatchedPermissions()}return this}},{key:"removeTemporaryMatchedPermission",value:function removeTemporaryMatchedPermission(temporaryMatchedPermission){var i=this.temporaryMatchedPermissions.indexOf(temporaryMatchedPermission);if(i!==-1){this.temporaryMatchedPermissions.splice(i,1);this.storeTemporaryMatchedPermissions()}return this}},{key:"storeTemporaryMatchedPermissions",value:function storeTemporaryMatchedPermissions(){this.storeHandler.setJson("__permission_barrier_temporary_matched_permission",this.temporaryMatchedPermissions);return this}},{key:"restoreTemporaryMatchedPermissions",value:function restoreTemporaryMatchedPermissions(){var _this3=this;(function(temporaryMatchedPermissions){temporaryMatchedPermissions&&(_this3.temporaryMatchedPermissions=temporaryMatchedPermissions)})(this.storeHandler.getJson("__permission_barrier_temporary_matched_permission"));return this}/**
     *
     * @param {Object} route
     * @param {Function|null} notPassCallback
     * @returns {boolean}
     */},{key:"passRoutes",value:function passRoutes(route){var notPassCallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(route.name in this.routes){return this.passAction(this.routes[route.name],notPassCallback)}return true}/**
     *
     * @param {Function|null} notPassCallback
     * @returns {boolean}
     */},{key:"passActions",value:function passActions(){var _this4=this;var notPassCallback=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(this.actions.length){return this.actions.every(function(action){return _this4.passAction(action,notPassCallback)})}return true}/**
     *
     * @param {PermissionBarrierAction} action
     * @param {Function|null} notPassCallback
     */},{key:"passAction",value:function passAction(action){var notPassCallback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.permit.match([].concat(_toConsumableArray(action.getMatchedPermissions()),_toConsumableArray(this.temporaryMatchedPermissions)),[].concat(_toConsumableArray(this.matchingPermissions),_toConsumableArray(this.temporaryMatchingPermissions)))){return true}notPassCallback&&notPassCallback(action);return false}}]);return PermissionBarrier}();exports.PermissionBarrier=PermissionBarrier;
//# sourceMappingURL=permission-barrier.js.map