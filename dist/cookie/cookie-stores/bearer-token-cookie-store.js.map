{"version":3,"sources":["../../../src/cookie/cookie-stores/bearer-token-cookie-store.js"],"names":["BearerTokenCookieStore","value","refreshToken","cookieStoreHandler","getJson","refreshTokenNaming","name","accessToken","tokenType","expiresIn","expires","refreshTokenExpires","transformed","storeTransform","Date","getTime","setTemporarySettings","setJson","remove","CookieStore"],"mappings":"obAAA,2C,6yFAEaA,CAAAA,sB,2TACT,2BAAkBC,KAAlB,CAAyB,CACrB,GAAMC,CAAAA,YAAY,CAAG,KAAKC,kBAAL,CAAwBC,OAAxB,CAAgC,KAAKC,kBAAL,CAAwB,KAAKC,IAA7B,CAAhC,CAArB,CACA,GAAIL,KAAJ,CAAW,CACP,MAAOC,CAAAA,YAAY,CAAG,CAClBK,WAAW,CAAEN,KAAK,CAACM,WADD,CAElBC,SAAS,CAAEP,KAAK,CAACO,SAFC,CAGlBC,SAAS,CAAER,KAAK,CAACQ,SAHC,CAIlBP,YAAY,CAAEA,YAJI,CAAH,CAKf,CACAK,WAAW,CAAEN,KAAK,CAACM,WADnB,CAEAC,SAAS,CAAEP,KAAK,CAACO,SAFjB,CAGAC,SAAS,CAAER,KAAK,CAACQ,SAHjB,CAKP,CACD,MAAOP,CAAAA,YAAY,CAAG,CAClBA,YAAY,CAAEA,YADI,CAAH,CAEf,IACP,C,8BAED,wBAAeD,KAAf,CAAsB,CAClB,MAAOA,CAAAA,KAAK,CAAG,CACXM,WAAW,CAAEN,KAAK,CAACM,WADR,CAEXC,SAAS,CAAEP,KAAK,CAACO,SAFN,CAGXN,YAAY,CAAED,KAAK,CAACC,YAHT,CAIXO,SAAS,CAAER,KAAK,CAACQ,SAJN,CAAH,CAKR,IACP,C,kCAED,4BAAmBH,IAAnB,CAAyB,CACrB,MAAOA,CAAAA,IAAI,CAAG,YACjB,C,sCAED,gCAAuBI,OAAvB,CAAgC,CAC5B,KAAKC,mBAAL,CAA2BD,OAA3B,CACA,MAAO,KACV,C,qBAED,eAAMT,KAAN,CAAa,CACT,GAAMW,CAAAA,WAAW,CAAG,KAAKC,cAAL,CAAoBZ,KAApB,CAApB,CACA,GAAIW,WAAJ,CAAiB,CACb,GAAMF,CAAAA,OAAO,CAAG,GAAII,CAAAA,IAAJ,CAAU,GAAIA,CAAAA,IAAJ,EAAD,CAAWC,OAAX,GAAuBH,WAAW,CAACH,SAAZ,CAAwB,IAAxD,CAAhB,CACA,KAAKR,KAAL,CAAa,CACTM,WAAW,CAAEK,WAAW,CAACL,WADhB,CAETC,SAAS,CAAEI,WAAW,CAACJ,SAFd,CAGTC,SAAS,CAAEG,WAAW,CAACH,SAHd,CAAb,CAKA,KAAKN,kBAAL,CACKa,oBADL,CAC0B,CAClBN,OAAO,CAAEA,OADS,CAD1B,EAIKO,OAJL,CAIa,KAAKX,IAJlB,CAIwB,KAAKL,KAJ7B,EAKA,KAAKA,KAAL,CAAWC,YAAX,CAA0BU,WAAW,CAACV,YAAtC,CACA,KAAKC,kBAAL,CACKa,oBADL,CAC0B,CAClBN,OAAO,CAAE,KAAKC,mBAAL,CAA2B,KAAKA,mBAAhC,CAAsDD,OAD7C,CAD1B,EAIKO,OAJL,CAKQ,KAAKZ,kBAAL,CAAwB,KAAKC,IAA7B,CALR,CAMQ,KAAKL,KAAL,CAAWC,YANnB,CAQH,CArBD,IAqBO,CACH,KAAKD,KAAL,CAAa,IAChB,CACD,MAAO,MAAKA,KACf,C,sBAED,iBAAS,CACL,KAAKU,mBAAL,CAA2B,IAA3B,CACA,KAAKR,kBAAL,CAAwBe,MAAxB,CAA+B,KAAKb,kBAAL,CAAwB,KAAKC,IAA7B,CAA/B,EACA,gFACH,C,mCAvEuCa,wB","sourcesContent":["import {CookieStore} from './cookie-store'\r\n\r\nexport class BearerTokenCookieStore extends CookieStore {\r\n    retrieveTransform(value) {\r\n        const refreshToken = this.cookieStoreHandler.getJson(this.refreshTokenNaming(this.name))\r\n        if (value) {\r\n            return refreshToken ? {\r\n                accessToken: value.accessToken,\r\n                tokenType: value.tokenType,\r\n                expiresIn: value.expiresIn,\r\n                refreshToken: refreshToken,\r\n            } : {\r\n                accessToken: value.accessToken,\r\n                tokenType: value.tokenType,\r\n                expiresIn: value.expiresIn,\r\n            }\r\n        }\r\n        return refreshToken ? {\r\n            refreshToken: refreshToken,\r\n        } : null\r\n    }\r\n\r\n    storeTransform(value) {\r\n        return value ? {\r\n            accessToken: value.accessToken,\r\n            tokenType: value.tokenType,\r\n            refreshToken: value.refreshToken,\r\n            expiresIn: value.expiresIn,\r\n        } : null\r\n    }\r\n\r\n    refreshTokenNaming(name) {\r\n        return name + '___refresh'\r\n    }\r\n\r\n    setRefreshTokenExpires(expires) {\r\n        this.refreshTokenExpires = expires\r\n        return this\r\n    }\r\n\r\n    store(value) {\r\n        const transformed = this.storeTransform(value)\r\n        if (transformed) {\r\n            const expires = new Date((new Date).getTime() + transformed.expiresIn * 1000)\r\n            this.value = {\r\n                accessToken: transformed.accessToken,\r\n                tokenType: transformed.tokenType,\r\n                expiresIn: transformed.expiresIn,\r\n            }\r\n            this.cookieStoreHandler\r\n                .setTemporarySettings({\r\n                    expires: expires,\r\n                })\r\n                .setJson(this.name, this.value)\r\n            this.value.refreshToken = transformed.refreshToken\r\n            this.cookieStoreHandler\r\n                .setTemporarySettings({\r\n                    expires: this.refreshTokenExpires ? this.refreshTokenExpires : expires,\r\n                })\r\n                .setJson(\r\n                    this.refreshTokenNaming(this.name),\r\n                    this.value.refreshToken,\r\n                )\r\n        } else {\r\n            this.value = null\r\n        }\r\n        return this.value\r\n    }\r\n\r\n    remove() {\r\n        this.refreshTokenExpires = null\r\n        this.cookieStoreHandler.remove(this.refreshTokenNaming(this.name))\r\n        super.remove()\r\n    }\r\n}\r\n"],"file":"bearer-token-cookie-store.js"}